{"remainingRequest":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\src\\module-manage\\components\\luochuanfu.vue?vue&type=style&index=0&id=71e4a8e6&scoped=true&lang=less&","dependencies":[{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\src\\module-manage\\components\\luochuanfu.vue","mtime":1666019319772},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\css-loader\\dist\\cjs.js","mtime":1662199726400},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1662199723728},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\postcss-loader\\src\\index.js","mtime":1662199720226},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\less-loader\\dist\\cjs.js","mtime":1665578966085},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662199701179},{"path":"C:\\Users\\辛虞\\Desktop\\脚手架vue项目\\blackDonkey\\node_modules\\vue-loader\\lib\\index.js","mtime":1662199723728}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouYm94LWNhcmQgew0KICBtYXJnaW46IDE4cHggMThweDsNCn0NCi5ibG9jayB7DQogIG1hcmdpbi10b3A6IDE4cHg7DQp9DQo="},{"version":3,"sources":["luochuanfu.vue"],"names":[],"mappings":";AA4UA;AACA;AACA;AACA;AACA;AACA","file":"luochuanfu.vue","sourceRoot":"src/module-manage/components","sourcesContent":["<template>\r\n  <div>\r\n    <el-card class=\"box-card\">\r\n      <!-- 头部搜索 + 新增 -->\r\n      <el-row :gutter=\"20\">\r\n        <el-form :inline=\"true\" class=\"demo-form-inline\">\r\n          <!-- 搜索 -->\r\n          <el-col :span=\"16\">\r\n            <div class=\"grid-content bg-purple\">\r\n              <!-- 搜索框 -->\r\n              <el-form-item>\r\n                <el-input v-model=\"page.title\" placeholder=\"根据用户名搜索\" />\r\n              </el-form-item>\r\n              <!-- 按钮 -->\r\n              <el-form-item>\r\n                <el-button @click=\"delSubmit\">清空</el-button>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" @click=\"onSubmit\">搜索</el-button>\r\n              </el-form-item>\r\n            </div>\r\n          </el-col>\r\n          <!-- 新增 -->\r\n          <el-col :span=\"6\" style=\"padding-left: 18%\">\r\n            <div class=\"grid-content bg-purple\">\r\n              <el-form-item style=\"margin-left: 18px\">\r\n                <el-button icon=\"el-icon-edit\" type=\"success\" @click=\"addSubmit\"\r\n                  >新增用户</el-button\r\n                >\r\n              </el-form-item>\r\n            </div>\r\n          </el-col>\r\n        </el-form>\r\n      </el-row>\r\n\r\n      <div\r\n        data-v-ad10840c=\"\"\r\n        role=\"alert\"\r\n        class=\"el-alert alert el-alert--info is-light\"\r\n      >\r\n        <i class=\"el-alert__icon el-icon-info\" />\r\n        <div class=\"el-alert__content\">\r\n          <span class=\"el-alert__title\">共 {{ counts }} 条记录</span>\r\n          <i class=\"el-alert__closebtn el-icon-close\" style=\"display: none\" />\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 表格 -->\r\n      <el-table\r\n        v-loading=\"loading\"\r\n        :data=\"tableData\"\r\n        style=\"width: 100%; margin-top: 18px\"\r\n      >\r\n        <el-table-column type=\"selection\" />\r\n        <el-table-column prop=\"title\" label=\"用户名\" />\r\n        <el-table-column prop=\"create_date\" label=\"日期\" sortable>\r\n          <template slot-scope=\"{ row }\">\r\n            {{ row.create_date | parseTime }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\">\r\n          <template slot-scope=\"{ row }\">\r\n            <el-button\r\n              type=\"primary\"\r\n              plain\r\n              size=\"small\"\r\n              icon=\"el-icon-edit\"\r\n              circle\r\n              @click=\"btnOk(row)\"\r\n            />\r\n            <el-button\r\n              type=\"danger\"\r\n              plain\r\n              size=\"small\"\r\n              icon=\"el-icon-delete\"\r\n              circle\r\n              @click=\"btndel(row)\"\r\n            />\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 新增弹出层 -->\r\n      <el-dialog\r\n        title=\"新增权限组\"\r\n        :visible.sync=\"dialogFormVisible\"\r\n        width=\"50%\"\r\n      >\r\n        <el-form ref=\"formDate\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\r\n          <el-form-item label=\"用户名\" prop=\"title\">\r\n            <el-input v-model=\"form.title\" style=\"width: 300px\"></el-input>\r\n          </el-form-item>\r\n          <!-- >&nbsp; -->\r\n          <el-form-item label=\"权限分配\">\r\n            <el-tree\r\n              ref=\"tree\"\r\n              :data=\"data\"\r\n              show-checkbox\r\n              default-expand-all\r\n              node-key=\"id\"\r\n              :props=\"defaultProps\"\r\n              :getCheckedKeys=\"getKeys\"\r\n            >\r\n            </el-tree>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"addOk\">确 定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n      <!-- 修改弹出层 -->\r\n      <el-dialog\r\n        title=\"修改权限组\"\r\n        :visible.sync=\"dialogFormVisible1\"\r\n        width=\"50%\"\r\n      >\r\n        <el-form\r\n          ref=\"formDate\"\r\n          :model=\"rowss\"\r\n          :rules=\"rules\"\r\n          label-width=\"80px\"\r\n        >\r\n          <el-form-item label=\"用户名\" prop=\"title\">\r\n            <el-input v-model=\"rowss.title\" style=\"width: 300px\"></el-input>\r\n          </el-form-item>\r\n          <!-- >&nbsp; -->\r\n          <el-form-item label=\"权限分配\">\r\n            <el-tree\r\n              ref=\"tree\"\r\n              :data=\"data\"\r\n              show-checkbox\r\n              default-expand-all\r\n              node-key=\"id\"\r\n              :props=\"defaultProps\"\r\n              :getCheckedKeys=\"rowss.permissions\"\r\n              :default-checked-keys=\"rowss.permissions\"\r\n            >\r\n            </el-tree>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogFormVisible1 = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"addOk1\">确 定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n\r\n      <!-- 分页 -->\r\n      <el-row :gutter=\"24\">\r\n        <el-col :span=\"8\" :push=\"14\"\r\n          ><div class=\"grid-content bg-purple\">\r\n            <div class=\"block\">\r\n              <el-pagination\r\n                v-if=\"counts > 0\"\r\n                background\r\n                :current-page.sync=\"page.page\"\r\n                :page-size.sync=\"page.pagesize\"\r\n                :page-sizes=\"[3, 6, 10, 25]\"\r\n                layout=\" prev, pager, next, sizes, jumper\"\r\n                :total=\"counts\"\r\n                @size-change=\"onSubmit\"\r\n                @current-change=\"onSubmit\"\r\n              />\r\n            </div></div\r\n        ></el-col>\r\n      </el-row>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { list, add, detail, update, remove } from '../../api/base/permissions'\r\nimport { list as listquanxz } from '../../api/base/menus'\r\nexport default {\r\n  name: 'permissions',\r\n  components: {},\r\n\r\n  data () {\r\n    return {\r\n      // 修改\r\n      rowss: {\r\n        id: '',\r\n        title: '',\r\n        permissions: [] // 存放的是默认选中的值和自己新增的值\r\n      },\r\n\r\n      data: [], // 用来存放树节点的值\r\n      defaultProps: {\r\n        children: 'childs',\r\n        label: 'title'\r\n      },\r\n      // 新增\r\n      form: {\r\n        title: '',\r\n        permissions: []\r\n      },\r\n      getKeys: [],\r\n      dialogFormVisible: false,\r\n      dialogFormVisible1: false,\r\n      loading: false,\r\n      page: {\r\n        page: 1, // 当前页\r\n        pagesize: 10, // 页的大小\r\n        title: ''\r\n      },\r\n      counts: 0, // 总记录数\r\n      pages: 0, // 总页数\r\n\r\n      tableData: [],\r\n      rules: {\r\n        title: [{ required: true, message: '请输入用户名', trigger: 'blur' }]\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    // dialig 标题显示\r\n\r\n    title () {\r\n      return this.form ? '编辑权限组' : '创建权限组'\r\n    }\r\n  },\r\n\r\n  created () {\r\n    this.onSubmit()\r\n    this.getquanx()\r\n  },\r\n  methods: {\r\n\r\n    // 搜索 + 渲染列表\r\n    async onSubmit () {\r\n      try {\r\n        this.loading = true\r\n        const { data } = await list(this.page)\r\n        // console.log(data)\r\n        this.tableData = data.list\r\n        this.page.page = data.page - 0\r\n        this.page.pagesize = data.pagesize - 0\r\n        this.counts = data.counts\r\n        if (this.counts > 0 && data.list.length === 0) {\r\n          this.page.page = this.page.page - 1\r\n          this.onSubmit()\r\n        }\r\n      } catch (err) {\r\n        console.log(err)\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    // 清空搜索\r\n    delSubmit () {\r\n      this.page = {\r\n        page: 1, // 当前页\r\n        pagesize: 10, // 页的大小\r\n        username: ''\r\n      }\r\n      // 再次调用接口渲染页面\r\n      this.onSubmit()\r\n    },\r\n    // 获取权限组名称\r\n    async getquanx () {\r\n      const { data } = await listquanxz()\r\n      // console.log(data)\r\n      this.data = data\r\n      // 给一个最大的父节点\r\n      this.data = [{ title: '系统菜单和页面权限点', childs: data, id: 0 }]\r\n    },\r\n    async addSubmit () {\r\n      this.dialogFormVisible = true\r\n    },\r\n    // 新增\r\n    async addOk (row) {\r\n      console.log(row)\r\n      this.$refs.formDate.validate() // 判断验证规则是否通过\r\n      const arr = this.$refs.tree.getCheckedKeys() // 获取点击数节点的id存放到数组里面\r\n      // console.log(arr)\r\n      this.form.permissions = arr\r\n      try {\r\n        // 调用接口\r\n        await add(this.form)\r\n        this.onSubmit()\r\n        this.$message.success('新增成功')\r\n      } catch (err) {\r\n        this.$message.error('新增失败')\r\n      } finally {\r\n        this.dialogFormVisible = false\r\n      }\r\n    },\r\n    // 修改 先数据回显\r\n    async btnOk (row) {\r\n      this.dialogFormVisible1 = true\r\n      const { data } = await detail(row)\r\n      // console.log(data)\r\n      this.rowss.permissions = data.permissions\r\n      this.rowss.title = data.title\r\n      this.rowss.id = data.id\r\n    },\r\n    // 修改 + 渲染\r\n    async addOk1 () {\r\n      this.$refs.formDate.validate() // 判断验证规则是否通过\r\n      // 调用接口\r\n      try {\r\n        await update(this.rowss)\r\n        this.onSubmit()\r\n        this.$message.success('修改成功')\r\n        // this.rowss.permissions = []\r\n        // console.log(this.rowss.permissions)\r\n      } catch (err) {\r\n        this.$message.error('修改失败')\r\n      } finally {\r\n        this.dialogFormVisible1 = false\r\n        // this.rowss.permissions = []\r\n      }\r\n    },\r\n    // 删除\r\n    async btndel (row) {\r\n      try {\r\n        await this.$confirm('此操作将永久删除用户, 是否继续?', '提示', {\r\n          type: 'warning'\r\n        })\r\n        await remove(row)\r\n        this.onSubmit()\r\n        this.$message.success('删除成功')\r\n      } catch (err) {\r\n        this.$message.error('删除失败')\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.box-card {\r\n  margin: 18px 18px;\r\n}\r\n.block {\r\n  margin-top: 18px;\r\n}\r\n</style>\r\n"]}]}